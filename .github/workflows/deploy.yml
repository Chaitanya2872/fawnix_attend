name: Deploy Fawnix Backend
 
on:

  push:

    branches:

      - main
 
jobs:

  deploy:

    runs-on: ubuntu-latest
 
    steps:

      - name: Checkout repository

        uses: actions/checkout@v4
 
      - name: Install sshpass

        run: sudo apt-get update && sudo apt-get install -y sshpass
 
      - name: Deploy to production server

        env:

          SERVER_IP: ${{ secrets.SERVER_IP }}

          SERVER_USER: ${{ secrets.SERVER_USER }}

          SERVER_PASSWORD: ${{ secrets.SERVER_PASSWORD }}

        run: |

          sshpass -p "$SERVER_PASSWORD" ssh -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP << 'EOF'

            set -e
 
            cd /root/backend/fawnix_attend
 
            git pull origin main
 
            docker compose build
 
            docker compose down
 
            docker compose up -d

          EOF

 